Sub stock_return()

'run the code below for each of the sheets
For Each ws In Worksheets

'for the current worksheet, find the number of rows in column A
lastrow = ws.Cells(Rows.count, "A").End(xlUp).Row - 1

'keep track of the location for each ticker in the results table
Dim results_table_row  As Integer
results_table_row = 2

'keep track of the ticker symbol
Dim ticker As String

'Calculate the total volume
Dim volume As Long
volume = 0

'help find the distance between the first time a ticker is shown and the last
Dim count As Integer
count = 0

'for the current worksheet, add the column headers for the data you wish to add
Range("J1").Value = "Ticker"
Range("K1").Value = "Yearly Change"
Range("L1").Value = "Percent Change"
Range("M1").Value = "Total Stock Volume"


'run through each row
    For r = 2 To lastrow
        
        'Check if we are still looking at the same ticker
        If Cells(r + 1, "A").Value <> Cells(r, "A").Value Then
            
            'set the ticker
            ticker = Cells(r, "A").Value
            
            'add to the volume
            volume = volume + Cells(r, "G").Value
            
            'print the ticker symbol
            Range("J" & results_table_row).Value = ticker
            
            'print the total volume
            Range("M" & results_table_row).Value = volume
            
            'print the yearly change
            Range("K" & results_table_row).Value = (Cells(r, "F").Value) - (Cells(r - count, "C").Value)
            
            'print the percent change (will reformat later on to percentages)
            Range("L" & results_table_row).Value = ((Cells(r, "F").Value) / (Cells(r - count, "C").Value)) - 1
            
            'add one to the results table row
            results_table_row = results_table_row + 1
            
            'reset volume
            volume = 0
            
            'reset count
            count = 0
            
        Else
        volume = volume + Cells(r, "G").Value
        count = count + 1
        
        End If
        
    Next r
    
Next ws
        
        

End Sub

