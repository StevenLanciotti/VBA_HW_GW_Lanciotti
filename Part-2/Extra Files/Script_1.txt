Sub stock_return()

'run the code below for each of the sheets
For Each ws In Worksheets

'for the current worksheet, find the number of rows in column A
lastrow = ws.Cells(Rows.count, "A").End(xlUp).Row - 1

'keep track of the location for each ticker in the results table
Dim results_table_row  As Long
results_table_row = 2

'keep track of the ticker symbol
Dim ticker As String

'Calculate the total volume
Dim volume As Long
volume = 0

'help find the distance between the first time a ticker is shown and the last
Dim count As Integer
count = 0

Dim change_new As Long
change_new = 0

Dim change_old As Long
change_old = 0

Dim pct_change As Long
pct_change = 0

'for the current worksheet, add the column headers for the data you wish to add
ws.Range("J1").Value = "Ticker"
ws.Range("K1").Value = "Yearly Change"
ws.Range("L1").Value = "Percent Change"
ws.Range("M1").Value = "Total Stock Volume"


'run through each row
    For r = 2 To lastrow
        
        'Check if we are still looking at the same ticker
        If ws.Cells(r + 1, 1).Value <> ws.Cells(r, 1).Value Then
            
            'set the ticker
            ticker = ws.Cells(r, 1).Value
            
            'add to the volume
            volume = volume + ws.Cells(r, 7).Value
            
            'print the ticker symbol
            ws.Range("J" & results_table_row).Value = ticker
            
            'print the total volume
            ws.Range("M" & results_table_row).Value = volume
            
            'print the yearly change
            ws.Range("K" & results_table_row).Value = (ws.Cells(r, 6).Value) - (ws.Cells(r - count, 3).Value)
            
            'print the percent change (will reformat later on to percentages)
            change_new = ws.Cells(r, 6).Value
            
            change_old = ws.Cells(r - count, 3).Value
            
            change = (change_new / change_old) - 1
            
            ws.Range("L" & results_table_row).Value = change
            
            'add one to the results table row
            results_table_row = results_table_row + 1
            
            'reset volume
            volume = 0
            
            'reset count
            count = 0
            
            'reset count
            change = 0
            change_new = 0
            change_old = 0
            
        Else
        volume = 0
        count = count + 1
        
        End If
        
    Next r
    
Next ws
        
        

End Sub